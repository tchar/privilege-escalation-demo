#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <stdlib.h>

// https://stackoverflow.com/a/7666577
unsigned long hash(char *str)
{
    unsigned long hash = 5381;
    int c = *str++;

    while (c) {
        hash = ((hash << 5) + hash) + c; /* hash * 33 + c */
        c = *str++;
    }

    return hash;
}

int main(int argc, char *argv[])
{
	if(argc==2)
  	{
		printf("Checking Licence: %s\n", argv[1]);
	        unsigned long int hashed_pwd = hash(argv[1]);
		// Password is "hello_stranger"
		if(hashed_pwd == 798418066827541118)
    	{
			printf("Access Granted!\n");
			setuid(0);
			setgid(0);
			system("/usr/bin/ps");
		}
		else
    	{
			printf("Wrong!\n");
		}	
	}
	else
  	{
		fprintf(stderr, "Usage: %s <password>\n", argv[0]);
		return 1;
	}
	
	return 0;
}
